<!DOCTYPE html>
<html lang="en">
<head>
    <base href="http://localhost:8080/ssm_framework_war_exploded/">
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
<h3>合同信息</h3>
<p>基本信息</p>
<div id="empId"></div>
<div id="empName"></div>
<div id="contractId"></div>
<div id="contractType">
    <select id="type">
        <option value="1">劳动合同</option>
        <option value="2">劳务合同</option>
        <option value="3">聘用合同</option>
        <option value="4">保密协议</option>
        <option value="5">竞业协议</option>
        <option value="6">培训协议</option>
    </select>
</div>
<div id="isTrainningContract"></div>
薪资：<input id="salary">
生效期：<input type="date" id="start">
失效期：<input type="date" id="end">
<p>续签记录</p>
<table id="contractTable" border="1" style="border-collapse: collapse">
    <tr>
        <td>生效期</td>
        <td>失效期</td>
        <td>负责人</td>
        <td>最后变更日期</td>
    </tr>
</table>
<input type="button" value="保存" id="save">
</body>
</html>
<script>
    var param = parseUrl(location.href);
    var empId = param["empId"];
    $.ajax({
        url:"contractInfo",
        data:{"empId":empId},
        dataType:"json",
        type:"get",
        success:function (data) {
            var effectTime = parseDate(data.object.effectTime);
            var failureTime = parseDate(data.object.failureTime);
            var modifyTime = parseDate(data.object.modifyTime);
            var trainning = "";
            if (data.object.isTrainningContract == 0){
                trainning = "否";
            }
            else{
                trainning = "是";
            }
            $("#empId").html("工号："+data.object.emp.empId);
            $("#empName").html("姓名："+data.object.emp.empName);
            $("#contractId").html("合同编号："+data.object.contractId);
            $("#isTrainningContract").html("签订培训协议："+trainning);
            $("#salary").val(data.object.salary);
            var contract = "<tr>" +
                "<td>"+effectTime+"</td>" +
                "<td>"+failureTime+"</td>" +
                "<td id='checkEmpName'>"+data.object.checkEmp.empName+"</td>" +
                "<td>"+modifyTime+"</td></tr>"
            $("#contractTable").append(contract);
        }
    });
    /**
     * 保存
     */
    $("#save").click(function () {
       var contractType = $("#type").val();
       var salary = $("#salary").val();
       var start = $("#start").val();
       var end = $("#end").val();
       var checkEmpName = $("#checkEmpName").html();
       var modifyTime = parseDate(new Date());
       $.ajax({
           url:"updateContract?empId="+empId+"&contractType="+contractType+"&salary="+salary+"&start="+start+"&end="+end,
           type:"put",
           dataType:"json",
           success:function (data) {
               if (data.code == 1){
                   $("#contractTable tr:eq(1)").remove();
                   var contract = "<tr>" +
                       "<td>"+start+"</td>" +
                       "<td>"+end+"</td>" +
                       "<td>"+checkEmpName+"</td>" +
                       "<td>"+modifyTime+"</td></tr>"
                   $("#contractTable").append(contract);
               }
           }
       })
    })
</script>